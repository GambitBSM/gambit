##########################################################################
## GAMBIT configuration for running a MultiNest scan of the MSSM7
## using likelihoods from DarkBit.
##
## The likelihood include direct DM search from DAMA experiment
## (plus constraints for the nuisance parameters).
##
## Nuisance parameters include the nuclear matrix elements, the SM Higgs
## mass and the dark matter halo parameters.
##########################################################################


Parameters:

  # SM parameters.
  StandardModel_SLHA2: !import include/StandardModel_SLHA2_scan.yaml

  # Nuclear matrix parameters.
  nuclear_params_sigmas_sigmal:
    sigmas:
      range:  [19, 67]
    sigmal:
      range:  [31, 85]
    deltau:
      fixed_value:  0.842
    deltad:
      fixed_value: -0.427
    deltas:
      fixed_value: -0.085

  # The model nuclear_params_sigmas_sigma0 replaces the sigmal in the above model
  # with sigma0

  #SUSY parameters.
  MSSM7atQ:
    Qin:
      fixed_value: 1000.0
    SignMu:
      fixed_value: 1
    Ad_3:
      prior_type: double_log_flat_join
      ranges: [-1e4, -1e2, 1e2, 1e4]
    Au_3:
      prior_type: double_log_flat_join
      ranges: [-1e4, -1e2, 1e2, 1e4]
    M2:
      prior_type: double_log_flat_join
      ranges: [-1e4, -1e2, 1e2, 1e4]
    TanBeta:
      range: [3.0, 70.0]
      prior_type: flat
    mHd2:
      prior_type: double_log_flat_join
      ranges: [-1e8, -1e4, 1e4, 1e8]
    mHu2:
      prior_type: double_log_flat_join
      ranges: [-1e8, -1e4, 1e4, 1e8]
    mf2:
      prior_type: double_log_flat_join
      ranges: [0, 0, 1e4, 1e8]

  # Dark matter halo parameters.
  Halo_gNFW_rho0:
    rho0:
      range: [.2, .8]
    v0: 235.0
    vesc: 550.0
    vrot: 235.0
    rs: 20.0
    r_sun: 8.5
    alpha: 1
    beta: 3
    gamma: 1

  # Halo_gNFW_rhos and Halo_Einasto_rhos replace rho0 in the above models
  # with rhos


Priors:

  # All priors simple, so specified in Parameters section


Printer:

  printer: ascii
  options:
    output_file: "MSSM7_DAMA.txt"
    buffer_length: 10
    delete_file_on_restart: true


Scanner:

 use_scanner: multinest

 scanners:
   multinest:
     plugin: multinest
     like:  LogLike
     nlive: 5000
     tol: 0.1
     updInt: 1

   random:
     plugin: random
     point_number: 100
     like:  LogLike
     printme: false


ObsLikes:

    # Direct detection likelihoods
    
    - capability: DAMA_LogLikelihood_mod
      purpose:    LogLike

Rules:

  # Do not rescale dark matter density based on the relic density.
  - capability: RD_fraction
    function: RD_fraction_one

  # Use DD_couplings from DarkSUSY
  - capability: DD_couplings
    function: DD_couplings_DarkSUSY

  # Choose where to get the precision spectrum from
  - capability: MSSM_spectrum
    type: Spectrum
    #function: make_MSSM_precision_spectrum_none
    #function: make_MSSM_precision_spectrum_W
    #function: make_MSSM_precision_spectrum_H_W
    function: make_MSSM_precision_spectrum_4H_W
    # The following options only have an impact when using make_MSSM_precision_spectrum_H_W
    # or make_MSSM_precision_spectrum_H_W.
    # Choose to take the precision prediction for the Higgs mass(es) (rather then spectrum generator's).
    # Choose to use the difference between the precision and spectrum generator predictions, along
    # with the precision error estimate, to estimate the theoretical error on the prediction.
    options:
      Higgs_predictions_source: 1
      Higgs_predictions_error_method: 4

  # Choose to get decays from DecayBit proper, not from an SLHA file.
  - capability: decay_rates
    function: all_decays

  # Choose to get the precision value of the SM-like Higgs mass from FeynHiggs or SUSYHD
  - capability: prec_mh
    function: FH_HiggsMass
    #function: SHD_HiggsMass

  # Choose to get the spectrum from SpecBit proper, not an SLHA file.
  # Options set to match benchmark point specified in SpecBit/MSSM_benchmark_points/LesHouches.in.MSSM_1
  - capability: unimproved_MSSM_spectrum
    function: get_MSSMatQ_spectrum_FS
    options:
      precision_goal:        1.0e-4
      max_iterations:        0
      calculate_sm_masses:   false
      pole_mass_loop_order:  2
      ewsb_loop_order:       2
      beta_loop_order:       2
      threshold_corrections_loop_order: 2
      use_higgs_2loop_at_as: true
      use_higgs_2loop_ab_as: true
      use_higgs_2loop_at_at: true
      use_higgs_2loop_atau_atau: true
      invalid_point_fatal: false

  # Choose to use functions that get Higgs decays from SUSY-HIT, and t decays from DecayBit native implementation (instead of FeynHiggs)
  - capability: Reference_SM_Higgs_decay_rates
    function: Ref_SM_Higgs_decays_table
  - capability: Reference_SM_other_Higgs_decay_rates
    function: Ref_SM_other_Higgs_decays_table
  - capability: Reference_SM_A0_decay_rates
    function: Ref_SM_A0_decays_table
  - capability: Higgs_decay_rates
    function: MSSM_h0_1_decays
  - capability: h0_2_decay_rates
    function: h0_2_decays
  - capability: A0_decay_rates
    function: A0_decays
  - capability: H_plus_decay_rates
    function: H_plus_decays
  - capability: t_decay_rates
    function: t_decays

  # All of the rest of this is new and should be checked!

  # Form of coupling constants passed to DDCalc
  - capability: DDCalc_Couplings
    function: DDCalc_Couplings_NR_WCs

  # These should be picked automatically for the MSSM I would have thought?
  # It also needs to be checked that it correct!
  - capability: DD_nonrel_WCs
    function: NREO_from_DD_couplings


Logger:

  redirection:
    [Debug] : "debug.log"
    [Default] : "default.log"
    [DecayBit] : "DecayBit.log"
    [DarkBit] : "DarkBit.log"
    [PrecisionBit] : "PrecisionBit.log"
    [FlavBit] : "FlavBit.log"
    [ColliderBit] : "ColliderBit.log"
    [SpecBit] : "SpecBit.log"
    [Dependency Resolver] : "dep_resolver.log"


KeyValues:

  dependency_resolution:
    prefer_model_specific_functions: true

  # Options for the likelihood in the scan
  # Can choose a likelihood below which models are thrown away
  likelihood:
    model_invalid_for_lnlike_below: -1e4

  debug: true

  # Set the output path for the log files (relative to working directory unless absolute path is specified)
  default_output_path: "runs/MSSM7-DarkBit/"
