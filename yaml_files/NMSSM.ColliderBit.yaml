# Inifile for testing SpecBit features

Parameters:

  #SM nuisance parameters.
  StandardModel_SLHA2: !import include/StandardModel_SLHA2_scan.yaml

  NMSSM66atQ:
    Qin:
      fixed_value: 3000  # 3000 = sqrt(mQL3*mUR3) = mSUSY, since we have mQL3 = mUR3 = mq2 = (3000)^2
    TanBeta:
      fixed_value: 28.7   # EWMSSM
      # fixed_value: 39.6
      # range: [1.0, 70.0]
      # prior_type: flat
    M1:
      fixed_value: -50.5   # EWMSSM
      # fixed_value: 2000.0
      # prior_type: double_log_flat_join
      # ranges: [-1e3, -1e1, 1e1, 1e3]
    M2:
      fixed_value: 149.3   # EWMSSM
      # fixed_value: 2000.0
      # prior_type: double_log_flat_join
      # ranges: [0, 0, 1e1, 1e3]
    M3:
      fixed_value: 3000
    kappa:
      # fixed_value: 0.016 
      prior_type: log
      range: [1e-5, 1]
    lambda:
      # fixed_value: 0.091 
      prior_type: log
      range: [1e-5, 1]
    Akappa:
      # fixed_value: -35.9
      prior_type: double_log_flat_join
      ranges: [-5e3, -1e1, 1e1, 5e3]
    Alambda:
      # fixed_value: 8940.
      prior_type: double_log_flat_join
      ranges: [-5e3, -1e1, 1e1, 5e3]
    mueff:
      fixed_value: 252.7   # EWMSSM
      # fixed_value: 163.3
      # prior_type: double_log_flat_join
      # ranges: [-1e3, -1e1, 1e1, 1e3]
    ml2_11:
      fixed_value: 9000000
    ml2_12:
      fixed_value: 0
    ml2_13:
      fixed_value: 0
    ml2_22:
      fixed_value: 9000000
    ml2_23:
      fixed_value: 0
    ml2_33:
      fixed_value: 9000000
    me2_11:
      fixed_value: 9000000
    me2_12:
      fixed_value: 0
    me2_13:
      fixed_value: 0
    me2_22:
      fixed_value: 9000000
    me2_23:
      fixed_value: 0
    me2_33:
      fixed_value: 9000000
    mq2_11:
      fixed_value: 9000000
    mq2_12:
      fixed_value: 0
    mq2_13:
      fixed_value: 0
    mq2_22:
      fixed_value: 9000000
    mq2_23:
      fixed_value: 0
    mq2_33:
      fixed_value: 9000000
    mu2_11:
      fixed_value: 9000000
    mu2_12:
      fixed_value: 0
    mu2_13:
      fixed_value: 0
    mu2_22:
      fixed_value: 9000000
    mu2_23:
      fixed_value: 0
    mu2_33:
      fixed_value: 9000000
    md2_11:
      fixed_value: 9000000
    md2_12:
      fixed_value: 0
    md2_13:
      fixed_value: 0
    md2_22:
      fixed_value: 9000000
    md2_23:
      fixed_value: 0
    md2_33:
      fixed_value: 9000000
    Ae_11:
       fixed_value: 0
    Ae_12:
       fixed_value: 0
    Ae_13:
       fixed_value: 0
    Ae_21:
       fixed_value: 0
    Ae_22:
       fixed_value: 0
    Ae_23:
       fixed_value: 0
    Ae_31:
       fixed_value: 0
    Ae_32:
       fixed_value: 0
    Ae_33:
       fixed_value: 0
    Ad_11:
       fixed_value: 0
    Ad_12:
       fixed_value: 0
    Ad_13:
       fixed_value: 0
    Ad_21:
       fixed_value: 0
    Ad_22:
       fixed_value: 0
    Ad_23:
       fixed_value: 0
    Ad_31:
       fixed_value: 0
    Ad_32:
       fixed_value: 0
    Ad_33:
       fixed_value: 0
    Au_11:
       fixed_value: 0
    Au_12:
       fixed_value: 0
    Au_13:
       fixed_value: 0
    Au_21:
       fixed_value: 0
    Au_22:
       fixed_value: 0
    Au_23:
       fixed_value: 0
    Au_31:
       fixed_value: 0
    Au_32:
       fixed_value: 0
    Au_33:
      fixed_value: 0
 
Priors:

Printer:

  printer: cout

  # printer: hdf5
  # options:
  #   output_file: "NMSSM.hdf5"
  #   delete_file_on_restart: true
  #   group: "/NMSSM"

Scanner:
  use_scanner: random

  scanners:

    random: 
      plugin: random 
      like:  LogLike 
      point_number: 1000
      output_file:  output 

    multinest:
      plugin: multinest
      like:  LogLike
      nlive: 5000
      tol: 0.1
      updInt: 1

    de:
      plugin: diver
      like: LogLike
      NP: 1
      convthresh: 1e-5
      verbosity: 1


ObsLikes:

  # Combined LHC likelihood
  - purpose:    LogLike
    capability: LHC_Combined_LogLike

  # Observables
  # - purpose:    Observable
  #   capability: SLHA1_violation

  - purpose:    Observable
    capability: NMSSM_spectrum
    function:   get_NMSSM_spectrum_as_map
    type:       map_str_dbl

  # - purpose:      Observable
  #   capability:   run_MSSMspectrum_test
  #   type:         bool

  - purpose:      Observable
    capability:   NMSSM_decay_rates_map
    function:     get_NMSSM_decay_rates_as_map
    type:         map_str_dbl


  - purpose:    likelihood_details
    capability: LHC_LogLike_per_analysis

  - purpose:    Observable
    capability: LHC_signals

  - purpose:    Observable
    capability: LHCEventLoopInfo

  # - purpose:      Observable
  #   capability:   decay_rates
  #   type:         DecayTable

Rules:

  - function: get_NMSSM_spectrum_SPheno
    options:
      WriteOutputForNonConvergence: true
      CalculateOneLoopMasses: true
      CalculateTwoLoopHiggsMasses: false
      drop_SLHA_file: false
      ErrorLevel: 2

  # - capability: run_MSSMspectrum_test
  #   function: SPheno_NMSSM_test
  #   options:
  #     drop_SLHA_file: false

  - capability: decay_rates
    function:   all_NMSSM_decays_from_SPheno
    options:
      drop_SLHA_file: false
      OneLoopDecays: false
      Enable3BDecaysF: false
      Enable3BDecaysS: false

  ##### LHC Detector and Analysis rules #####
  #
  # The current capability structure allows for the user to mix'n'match
  # collider settings, detector sims and analyses. The user may run BuckFastATLAS
  # with ATLAS analyses, BuckFastCMS with CMS analyses, and Delphes with any analyses,
  # for various configurations of Pythia.
  #
  # The way to turn the detectors on or off is via the boolean option useDetector for
  # the module functions getDelphes, getBuckFastATLAS and getBuckFastCMS.
  #
  # NOTE: The use of Delphes currently only works when running with OMP_NUM_THREADS=1

  # Choose Monte Carlo event simulator.
  - capability:  ColliderOperator
    function: operateLHCLoop
    options:
      pythiaNames: ["Pythia_SUSY_LHC_13TeV_EWonly"]
      silenceLoop: false
      maxFailedEvents: 1000
      pythiaSeedBase: -1    # If -1, a new seed is generated for every Pythia configuration and parameter point 

  # Choose statistical settings for Monte Carlo event generator
  - capability: MC_ConvergenceSettings
    options:
      min_nEvents: [100]
      max_nEvents: [100]
      events_between_convergence_checks: [200000]
      target_fractional_uncert: [0.1]
      halt_when_systematic_dominated: true
      all_analyses_must_converge: true
      all_SR_must_converge: false

  # Define Monte Carlo event simulator and associated options.
  - capability:  HardScatteringSim
    function:  getPythia
    options:
      # Pythia_doc_path defaults to the xmldoc directory of the default Pythia
      # backend. So, this must only be set if the user chooses a different Pythia.
      # Pythia_doc_path: "Backends/installed/Pythia/8.212/share/Pythia8/xmldoc/"
      Pythia_SUSY_LHC_13TeV_EWonly: ["Print:quiet = on",
                                     "Next:numberCount = 0",
                                     "Random:setSeed = on",
                                     "Beams:eCM = 13000",
                                     "PartonLevel:MPI = off",
                                     "PartonLevel:ISR = on",
                                     "PartonLevel:FSR = on",
                                     "HadronLevel:all = on",
                                     "SUSY:all = off",
                                     "SUSY:qqbar2chi0chi0 = on",
                                     "SUSY:qqbar2chi+-chi0 = on",
                                     "SUSY:qqbar2chi+chi- = on",
                                     "TauDecays:mode = 0",
                                     "TimeShower:pTmin = 20"]

      xsec_vetos: [0.028]  # 0.028 fb corresponds to ~1 expected event at L = 36 fb^-1.


  # Rules and options for BuckFast ATLAS simulation
  - capability: SimpleSmearingSim
    type: "ColliderBit::BuckFastSmearATLAS"
    function: getBuckFastATLAS
    options:
      # useDetector defaults to true for getBuckFastATLAS. Set it to false to ignore all ATLAS analyses and disable the BuckFast ATLAS simulator
      useDetector: [true]
      # Choose which type of event to use: for parton level, change partonOnly to true
      partonOnly: [false]
      antiktR: [0.4]

  # Rules and options for BuckFast ATLAS simulation witout efficiencies
  - capability: SimpleSmearingSim
    type: "ColliderBit::BuckFastSmearATLASnoeff"
    function: getBuckFastATLASnoeff
    options:
      # useDetector defaults to true for getBuckFastATLAS. Set it to false to ignore all ATLAS analyses and disable the BuckFast ATLAS simulator
      useDetector: [false]
      # Choose which type of event to use: for parton level, change partonOnly to true
      partonOnly: [false]
      antiktR: [0.4]

  # Rules and options for BuckFast CMS simulation
  - capability: SimpleSmearingSim
    type: "ColliderBit::BuckFastSmearCMS"
    function: getBuckFastCMS
    options:
      # useDetector defaults to true for getBuckFastCMS. Set it to false to ignore all CMS analyses and disable the BuckFast CMS simulator
      useDetector: [false]
      # Choose which type of event to use: for parton level, change partonOnly to true
      partonOnly: [false]
      antiktR: [0.4]

  # Rules and options for BuckFast CMS simulation witout efficiencies
  - capability: SimpleSmearingSim
    type: "ColliderBit::BuckFastSmearCMSnoeff"
    function: getBuckFastCMSnoeff
    options:
      # useDetector defaults to true for getBuckFastCMS. Set it to false to ignore all CMS analyses and disable the BuckFast CMS simulator
      useDetector: [false]
      # Choose which type of event to use: for parton level, change partonOnly to true
      partonOnly: [false]
      antiktR: [0.4]


  # ATLAS analysis setup.
  # NOTE: Don't blindly copy this analysis list without also checking the
  #       "skip_analyses" list for "LHC_Combined_LogLike" below.
  - capability: ATLASAnalysisContainer
    function: getATLASAnalysisContainer
    options:
      analyses: [ [ "ATLAS_13TeV_4LEP_36invfb" ] ]

                    # "ATLAS_13TeV_RJ3L_2Lep2Jets_36invfb",
                    # "ATLAS_13TeV_RJ3L_3Lep_36invfb",
                    # "ATLAS_13TeV_MultiLEP_2Lep0Jets_36invfb",
                    # "ATLAS_13TeV_MultiLEP_2LepPlusJets_36invfb",
                    # "ATLAS_13TeV_MultiLEP_3Lep_36invfb",
                    # "ATLAS_13TeV_3b_24invfb",
                    # "ATLAS_13TeV_3b_discoverySR_24invfb",
                    # "ATLAS_13TeV_3b_36invfb",
                    # "ATLAS_13TeV_3b_discoverySR_36invfb" ] ]

  # ATLASnoeff analysis setup.
  # NOTE: Don't blindly copy this analysis list without also checking the
  #       "skip_analyses" list for "LHC_Combined_LogLike" below.
  - capability: ATLASnoeffAnalysisContainer
    function: getATLASnoeffAnalysisContainer
    options:
      analyses: [ [ ] ]

  # CMS analysis setup
  # NOTE: Don't blindly copy this analysis list without also checking the
  #       "skip_analyses" list for "LHC_Combined_LogLike" below.
  - capability: CMSAnalysisContainer
    function: getCMSAnalysisContainer
    options:
      analyses: [ [ "CMS_13TeV_1LEPbb_36invfb" ] ]
                    # "CMS_13TeV_MONOJET_36invfb" ] ]

  # CMSnoeff analysis setup
  # NOTE: Don't blindly copy this analysis list without also checking the
  #       "skip_analyses" list for "LHC_Combined_LogLike" below.
  - capability: CMSnoeffAnalysisContainer
    function: getCMSnoeffAnalysisContainer
    options:
      analyses: [ [ "CMS_13TeV_2LEPsoft_36invfb",
                    "CMS_13TeV_2LEPsoft_36invfb_nocovar",
                    "CMS_13TeV_MultiLEP_2SSLep_36invfb",
                    "CMS_13TeV_MultiLEP_3Lep_36invfb",
                    "CMS_13TeV_2OSLEP_36invfb",
                    "CMS_13TeV_2OSLEP_36invfb_nocovar" ] ]


  # List any analyses that should *NOT* be included in the total log-likelihood!
  # These will still be computed if listed in the analysis setup above, 
  # but their likelihood will not added to the combined likelihood.
  - capability: LHC_Combined_LogLike
    options:
     skip_analyses: [ "CMS_13TeV_2LEPsoft_36invfb_nocovar",
                       "CMS_13TeV_2OSLEP_36invfb_nocovar",
                       "ATLAS_13TeV_3b_discoverySR_24invfb",
                       "ATLAS_13TeV_3b_discoverySR_36invfb",
                       "ATLAS_13TeV_3b_36invfb" ]

  # Use lognormal errors when marginalising the LHC Poisson likelihoods over systematic uncertainties
  # Can change "_lognormal_" to "_gaussian_" if you prefer
  - capability: LHC_LogLikes
    backends:
    - {capability: lnlike_marg_poisson_lognormal_error}
    options:
      covariance_marg_convthres_abs: 0.05
      covariance_marg_convthres_rel: 0.05
      covariance_nsamples_start: 100000



Logger:

  redirection:
    [Debug] : "debug.log"
    [Default] : "default.log"
    [SpecBit] : "SpecBit.log"
    [DecayBit] : "DecayBit.log"
    [ColliderBit] : "ColliderBit.log"
    [PrecisionBit] : "PrecisionBit.log"

KeyValues:

  debug: true

  drop_SLHA_file: false

  default_output_path: "runs/NMSSM/"

  dependency_resolution:
    prefer_model_specific_functions: false

  likelihood:
    model_invalid_for_lnlike_below: -5e5
    model_invalid_for_lnlike_below_alt: -1e5

