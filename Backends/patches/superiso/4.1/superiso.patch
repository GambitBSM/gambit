Binary files 4.1/.DS_Store and 4.1_patched/.DS_Store differ
diff -ruN 4.1/src/Makefile 4.1_patched/src/Makefile
--- 4.1/src/Makefile	2019-07-26 00:41:18.000000000 +0930
+++ 4.1_patched/src/Makefile	2020-04-29 01:11:09.000000000 +0930
@@ -37,7 +37,7 @@
 	  libsuperiso.a(spheno.o) libsuperiso.a(suspect.o) libsuperiso.a(2hdmc.o)\
 	  libsuperiso.a(fleshouches.o) libsuperiso.a(bsll.o) libsuperiso.a(bsll_extra.o)\
 	  libsuperiso.a(bkll.o) libsuperiso.a(bkstarll.o) libsuperiso.a(bkstargamma.o) libsuperiso.a(bsphill.o)\
-	  libsuperiso.a(chi2.o) libsuperiso.a(zwidths.o) libsuperiso.a(nmssmtools.o)\
+	  libsuperiso.a(chi2.o) libsuperiso.a(zwidths.o) libsuperiso.a(nmssmtools.o) libsuperiso.a(mixings.o) \
 	  $(RANL)
 
 libsuperiso.a(softsusy.o): softsusy.c include.h softsusy.h
@@ -70,6 +70,7 @@
 libsuperiso.a(bsphill.o): bsphill.c include.h
 libsuperiso.a(chi2.o): chi2.c include.h
 libsuperiso.a(zwidths.o): zwidths.c include.h
+libisospin.a(mixings.o): mixings.c include.h
 
 softsusy.h:
 	@echo \#define SOFTSUSY \"$(SOFTSUSY)\" > softsusy.h;
diff -ruN 4.1/src/mixings.c 4.1_patched/src/mixings.c
--- 4.1/src/mixings.c	1970-01-01 09:30:00.000000000 +0930
+++ 4.1_patched/src/mixings.c	2020-04-18 02:42:48.000000000 +0930
@@ -0,0 +1,251 @@
+#include "include.h"
+
+/*--------------------------------------------------------------------*/
+/*---------------------------1511.05066-------------------------------*/
+/*--------------------------------------------------------------------*/
+
+double AWW(double x)
+{
+		if(fabs(1.-x)<1.e-5) return AWW(0.9999);
+		
+		return 1.+9./(1.-x)-6./(1.-x)/(1.-x)-6.*x*x*log(x)/pow(1.-x,3.);
+}
+
+/*--------------------------------------------------------------------*/
+
+double AWH(double xH, double xt, double xb, double lu, double ld)
+{
+		if((fabs(1.-xH)<1.e-5)&&(fabs(1.-xt)<1.e-5)) return AWH(0.9998,1.0002,xb,lu,ld);
+
+		if(fabs(1.-xH)<1.e-5) return AWH(0.9999,xt,xb,lu,ld);
+		if(fabs(1.-xt)<1.e-5) return AWH(xH,0.9999,xb,lu,ld);
+
+		if(fabs(1.-xH/xt)<1.e-5) return AWH(xt*0.9998,xt,xb,lu,ld);
+		
+		double xt2=xt*xt;
+		double xt3=xt*xt2;
+		double xt4=xt*xt3;
+		double xt5=xt*xt4;
+		
+		double xH2=xH*xH;
+		double xH3=xH*xH2;
+		double xH4=xH*xH3;
+		
+		return lu*lu*((4.-xt)/(xt-1.)/(xH-xt)+(xH-4.)*xH*log(xH)/(xH-1.)/(xH-xt)/(xH-xt)+(3.*xt2-(xt2-2.*xt+4.)*xH)*log(xt)/pow((xt-1.)*(xH-xt),2.))
+		+2.*xb/xt*(2.*ld*lu*(-1./(xH-xt)/(xt-1.)+xH*log(xH)/(xH-1.)/(xH-xt)/(xH-xt)-(-xH+xt2)*log(xt)/(xH-xt)/(xH-xt)/(xt-1.)/(xt-1.))
+		+lu*lu*(-1./36./(xH-1.)/(xH-1.)/pow((xH-xt)*(xt-1.),3.)*(-xH4*(-12.+65.*xt+2.*xt2+5.*xt3)
+		+2.*xH3*(-12.+47.*xt+85.*xt2-11.*xt3+11.*xt4)+xH2*(12.+91.*xt-574.*xt2+246.*xt3-130.*xt4-5.*xt5)
+		+2.*xH*xt*(-30.+95.*xt+49.*xt2-11.*xt3+17.*xt4)+xt2*(-24.+43.*xt-110.*xt2+31.*xt3))
+		-1./6./pow((xH-xt)*(xt-1.),4.)*(xt*((xH3-3.*xH2*xt)*(1.+9.*xt)-xt4*(12.-3.*xt+xt2)+3.*xH*xt*(4.-12.*xt+24.*xt2-7.*xt3+xt4))*log(xt))
+		-1./6./pow((xH-xt)*(xH-1.),3.)/(xH-xt)*(xt*xH*(-3.*xH3*(-3.+xt)+12.*xt*(1.+xt)-3.*xH*xt*(13.+xt)+xH2*(1.+10.*xt+xt2))*log(xH))));
+}
+
+/*--------------------------------------------------------------------*/
+
+double AHH(double xH, double xt, double xb, double lu)
+{
+		if((fabs(1.-xH)<1.e-5)&&(fabs(1.-xt)<1.e-5)) return AHH(0.9998,1.0002,xb,lu);
+
+		if(fabs(1.-xH)<1.e-5) return AHH(0.9999,xt,xb,lu);
+		if(fabs(1.-xt)<1.e-5) return AHH(xH,0.9999,xb,lu);
+
+		if(fabs(1.-xH/xt)<1.e-5) return AHH(xt*0.9998,xt,xb,lu);
+		
+		double xt2=xt*xt;
+		double xt3=xt*xt2;
+		
+		double xH2=xH*xH;
+		double xH3=xH*xH2;
+		
+		return pow(lu,4.)*((xt+xH)/(xt-xH)/(xt-xH)-2.*xt*xH/pow(xt-xH,3.)*log(xt/xH)
+		-xb*(1./9./pow(xH-xt,4.)*(5.*xH2-22.*xH*xt+5.*xt2)+1./3./pow(xH-xt,5.)*(xH3-3.*xH2*xt-3.*xH*xt2+xt3)*log(xt/xH)));	
+}
+
+/*--------------------------------------------------------------------*/
+
+double AHH_RR(double xH, double xt, double ld)
+{
+               if((fabs(1.-xH)<1.e-5)&&(fabs(1.-xt)<1.e-5)) return AHH_RR(0.9998,1.0002,ld);
+
+               if(fabs(1.-xH)<1.e-5) return AHH_RR(0.9999,xt,ld);
+               if(fabs(1.-xt)<1.e-5) return AHH_RR(xH,0.9999,ld);
+
+               if(fabs(1.-xH/xt)<1.e-5) return AHH_RR(xt*0.9998,xt,ld);
+               
+               double xt2=xt*xt;
+               double xt3=xt*xt2;
+               
+               double xH2=xH*xH; 
+               double xH3=xH*xH2;
+               
+               return (xt/xH)*pow(ld,4.)*(xt+xH)/(xt-xH)/(xt-xH)-2.*xt*xH/pow(xt-xH,3.)*log(xt/xH);
+}
+
+/*--------------------------------------------------------------------*/
+
+double AWH_ST(double xH, double xt, double lu, double ld)
+{
+		if((fabs(1.-xH)<1.e-5)&&(fabs(1.-xt)<1.e-5)) return AWH_ST(0.9998,1.0002,lu,ld);
+
+		if(fabs(1.-xH)<1.e-5) return AWH_ST(0.9999,xt,lu,ld);
+		if(fabs(1.-xt)<1.e-5) return AWH_ST(xH,0.9999,lu,ld);
+
+		if(fabs(1.-xH/xt)<1.e-5) return AWH_ST(xt*0.9998,xt,lu,ld);
+		
+		double xt2=xt*xt;
+		double xt3=xt*xt2;
+		double xt4=xt*xt3;
+		double xt5=xt*xt4;
+		
+		double xH2=xH*xH;
+		double xH3=xH*xH2;
+		double xH4=xH*xH3;
+		
+		return lu*lu*(1./9./pow((1.-xH)*(xH-xt)*(1.-xt),2.)/(xH-xt)/(1.-xt)*((xt2+xH4)*(-11.+7.*xt-2.*xt2)+xH*xt*(7.+53.*xt-55.*xt2+19.*xt3)
+		+xH2*(-2.-55.*xt+15.*xt2+17.*xt3-11.*xt4)+xH3*(19.+17.*xt-19.*xt2+7.*xt3))
+		+1./3./pow((1.-xH)*(xH-xt),3.)/(xH-xt)*(2.*xH*(xH2+(-3.+xH)*xH*xt+(3.+(xH-3.)*xH)*xt2)*log(xH))
+		-1./3./pow((xH-xt)*(1.-xt),4.)*(2.*(xH3-3.*xH2*xt+3.*xH*xt2-3.*xt4+3.*xt5-xt*xt5)*log(xt)))
+		+ld*lu*(1./2./(1.-xH)/pow((xH-xt)*(1.-xt),2.)*((xH2+xt)*(-3.+xt)+xH*(1.+6.*xt-3.*xt2))
+		+1./pow((xH-xt)*(1.-xt),3.)*((xH2-2.*xH*xt-(-2.+xt)*xt3)*log(xt))-1./pow((1.-xH)*(xH-xt),2.)/(xH-xt)*(xH*(xH-2.*xt+xH*xt)*log(xH)));	
+}
+
+/*--------------------------------------------------------------------*/
+
+double AHH_ST(double xH, double xt, double lu, double ld)
+{
+		if((fabs(1.-xH)<1.e-5)&&(fabs(1.-xt)<1.e-5)) return AHH_ST(0.9998,1.0002,lu,ld);
+
+		if(fabs(1.-xH)<1.e-5) return AHH_ST(0.9999,xt,lu,ld);
+		if(fabs(1.-xt)<1.e-5) return AHH_ST(xH,0.9999,lu,ld);
+
+		if(fabs(1.-xH/xt)<1.e-5) return AHH_ST(xt*0.9998,xt,lu,ld);
+		
+		double xt2=xt*xt;
+		double xt3=xt*xt2;
+		
+		double xH2=xH*xH;
+		double xH3=xH*xH2;
+		
+		return pow(ld*lu,2.)*(2./(xH-xt)/(xH-xt)+(xt+xH)/pow(xH-xt,3.)*log(xt/xH))
+		+pow(lu,4.)*(1./18./pow(xH-xt,4.)*(5.*xH2-22.*xH*xt+5.*xt2)+1./6./pow(xH-xt,5.)*(xH3-3.*xH2*xt-3.*xH*xt2+xt3)*log(xt/xH))
+		+ld*pow(lu,3.)*(2./(xH-xt)/(xH-xt)+(xH+xt)/pow(xH-xt,3.)*log(xt/xH));
+}
+
+/*--------------------------------------------------------------------*/
+
+double Delta_MB(struct parameters* param)
+/* computes the B_d mass difference Delta_MB*/
+{
+
+	double MH=param->mass_H;
+	double MW=param->mass_W;
+	
+	double fB2_Bd=pow(param->f_B,2.)*1.27; /* 1511.05066 */
+	double etaB=0.551;
+	double mt=running_mass(param->mtmt,param->mtmt,160.,param->mass_top_pole,param->mass_b,param);
+	double mb=running_mass(param->mass_b,param->mass_b,160.,param->mass_top_pole,param->mass_b,param);
+	
+	double xt=pow(mt/MW,2.);
+	
+	if(param->SM==1) 
+	{
+		double dmb=pow(param->Gfermi*MW,2.)*param->m_Bd/(24.*pow(pi,2.))*pow(cabs(conj(param->Vtd)*param->Vtb),2.)*fB2_Bd*etaB*xt*AWW(xt);
+	
+		return dmb/6.582119e-25*1.e-12; /* from GeV to ps-1 */
+	}
+
+	double xb=pow(mb/MW,2.);
+	double xH=pow(MH/MW,2.);
+
+	double ltt;
+	if(param->THDM_model>0) ltt=param->lambda_u[3][3];
+	else ltt=-1./param->tan_beta;
+
+	double lbb;
+	if(param->THDM_model>0) lbb=param->lambda_d[3][3];
+	else lbb=param->tan_beta;
+	
+	double CV=xt*(AWW(xt)+2.*xt*AWH(xH,xt,xb,ltt,lbb)+xt*AHH(xH,xt,xb,ltt));
+	double CST=4.*xb*xt*xt*(AWH_ST(xH,xt,ltt,lbb)+AHH_ST(xH,xt,ltt,lbb)); // CST=0;
+
+	double fB2_BdST_etaBST=pow(0.190,2.)*(-0.007)-pow(0.183,2.)*(5./8*1.654+5./2.*(-0.007));
+
+	double dmb=pow(param->Gfermi*MW,2.)*param->m_Bd/(24.*pow(pi,2.))*pow(cabs(conj(param->Vtd)*param->Vtb),2.)*(fB2_Bd*etaB*CV+fB2_BdST_etaBST*CST);
+	
+	return dmb/6.582119e-25*1.e-12; /* from GeV to ps-1 */
+}
+
+/*--------------------------------------------------------------------*/
+
+double Delta_MB_calculator(char name[])
+/* "container" function scanning the SLHA file "name" and calculating Delta_MB */
+{
+	struct parameters param;
+		
+	Init_param(&param);
+	
+	if(!Les_Houches_Reader(name,&param)) return 0.;
+
+	return Delta_MB(&param);
+}
+
+/*--------------------------------------------------------------------*/
+
+double Delta_MBs(struct parameters* param)
+/* computes the B_s mass difference Delta_MBs*/
+{
+
+	double MH=param->mass_H;
+	double MW=param->mass_W;
+	
+	double fBs2_Bs=pow(param->f_Bs,2.)*1.33; /* 1511.05066 */
+	double etaBs=0.551;
+	double mt=running_mass(param->mtmt,param->mtmt,160.,param->mass_top_pole,param->mass_b,param);
+	double mb=running_mass(param->mass_b,param->mass_b,160.,param->mass_top_pole,param->mass_b,param);
+       double ms=running_mass(param->mass_s,param->mass_s,160.,param->mass_top_pole,param->mass_b,param); 	
+
+	double xt=pow(mt/MW,2.);
+	
+	if(param->SM==1) 
+	{
+		double dmbs=pow(param->Gfermi*MW,2.)*param->m_Bs/(24.*pow(pi,2.))*pow(cabs(conj(param->Vts)*param->Vtb),2.)*fBs2_Bs*etaBs*xt*AWW(xt);
+	
+		return dmbs/6.582119e-25*1.e-12; /* from GeV to ps-1 */
+	}
+
+       double xs=pow(ms/MW,2.);
+	double xb=pow(mb/MW,2.);
+	double xH=pow(MH/MW,2.);
+
+	double ltt;
+	if(param->THDM_model>0) ltt=param->lambda_u[3][3];
+	else ltt=-1./param->tan_beta;
+
+	double lbb;
+	if(param->THDM_model>0) lbb=param->lambda_d[3][3];
+	else lbb=param->tan_beta;
+	
+	double CV_LL=xt*(AWW(xt)+2.*xt*AWH(xH,xt,xb,ltt,lbb)+xt*AHH(xH,xt,xb,ltt));
+       double CV_RR=xb*xs*AHH_RR(xH,xt,lbb);
+	double CST=4.*xb*xt*xt*(AWH_ST(xH,xt,ltt,lbb)+AHH_ST(xH,xt,ltt,lbb)); // CST=0;
+
+	double fBs2_BsST_etaBsST=pow(0.231,2.)*(-0.007)-pow(0.225,2.)*(5./8*1.654+5./2.*(-0.007));
+
+	double dmbs=pow(param->Gfermi*MW,2.)*param->m_Bs/(24.*pow(pi,2.))*pow(cabs(conj(param->Vts)*param->Vtb),2.)*(fBs2_Bs*etaBs*(CV_LL + CV_RR)+fBs2_BsST_etaBsST*CST);
+	
+	return dmbs/6.582119e-25*1.e-12; /* from GeV to ps-1 */
+}
+
+/*--------------------------------------------------------------------*/
+
+double Delta_MBs_calculator(char name[])
+/* "container" function scanning the SLHA file "name" and calculating Delta_MBs */
+{
+	struct parameters param;
+		
+	Init_param(&param);
+	
+	if(!Les_Houches_Reader(name,&param)) return 0.;
+
+	return Delta_MBs(&param);
+}
--- a/src/chi2.c	2020-10-14 19:40:57.635018399 +0200
+++ b/src/chi2.c	2020-10-14 19:41:08.083031147 +0200
@@ -2815,9 +2815,6 @@ void get_th_covariance_nuisance(double *
 
 	for(ie=0;ie<*nbobs;ie++) values_mod[0][ie]=values_ref[ie];		
 
-#if defined(_OPENMP)	
-#pragma omp parallel for private(ie)
-#endif
 	for(ke=1;ke<=n;ke++)
 	{			
 		double values[*nbobs];
--- a/src/wilson.c	2023-09-21 17:42:02.075695421 +0200
+++ b/src/wilson.c	2023-09-21 17:42:21.388121743 +0200
@@ -984,6 +984,8 @@ double EH(double x, double lu)
 double G4H(double x, double lu)
 {
 	if(fabs(1.-x)<1.e-5) return G4H(0.9999,lu);
+	// Modified by GAMBIT, for values of x close to 1 interpolate surrounding values
+	if(fabs(1.-x)<1e-2) return G4H(1.01,lu)*(50.*x-49.5) + G4H(0.99,lu)*(50.5-50*x);
 
 	return lu*lu*((515.*x*x*x-906.*x*x+99.*x+182.)*x*Li2(1.-1./x)/54./pow(x-1.,4.)
 	+(1030.*x*x*x-2763.*x*x-15.*x+980.)*x*log(x)/108./pow(x-1.,5.)
@@ -995,6 +997,8 @@ double G4H(double x, double lu)
 double Delta4H(double x, double lu)
 {
 	if(fabs(1.-x)<1.e-5) return Delta4H(0.9999,lu);
+	// Modified by GAMBIT, for values of x close to 1 interpolate surrounding values
+	if(fabs(1.-x)<1e-2) return Delta4H(1.01,lu)*(50.*x-49.5) + Delta4H(0.99,lu)*(50.5-50*x);
 
 	return -lu*lu*((-375.*x*x-95.*x+182.)*x*log(x)/54./pow(x-1.,5.)
 	+(133.*x*x*x-108.*x*x+4023.*x-2320.)*x/324./pow(x-1.,4.));
@@ -1005,6 +1009,8 @@ double Delta4H(double x, double lu)
 double G3H(double x, double lu)
 {
 	if(fabs(1.-x)<1.e-5) return G3H(0.9999,lu);
+	// Modified by GAMBIT, for values of x close to 1 interpolate surrounding values
+	if(fabs(1.-x)<1e-2) return G3H(1.01,lu)*(50.*x-49.5) + G3H(0.99,lu)*(50.5-50*x);
 
 	return lu*lu*((10.*x*x*x+30.*x-20.)*x*Li2(1.-1./x)/27./pow(x-1.,4.)
 	+(30.*x*x-66.*x-56.)*x*log(x)/81./pow(x-1.,4.)
@@ -1161,6 +1167,8 @@ double C7H2ldlumt(double r)
 double C7H2(double yt, double lu, double ld, double L)
 {
 	if(fabs(1.-yt)<1.e-5) return C7H2(0.9999,lu,ld,L);
+	// Modified by GAMBIT, for values of yt close to 1 interpolate surrounding values
+	if(fabs(1.-yt)<1e-2) return C7H2(1.01,lu,ld,L)*(50.*yt-49.5) + C7H2(0.99,lu,ld,L)*(50.5-50*yt);
 
 	return lu*lu*(C7H2lulumt(yt)+L*(-yt*(67930.*pow(yt,4.)-470095.*pow(yt,3.)+1358478.*yt*yt-700243.*yt+54970.)/2187./pow(yt-1.,5.)+yt*(10422.*pow(yt,4.)-84390.*pow(yt,3.)+322801.*yt*yt-146588.*yt+1435.)/729./pow(yt-1.,6.)*log(yt)+2.*yt*yt*(260.*pow(yt,3.)-1515.*yt*yt+3757.*yt-1446.)/27./pow(yt-1.,5.)*Li2(1.-1./yt))
 	+L*L*(yt*(-518.*pow(yt,4.)+3665.*pow(yt,3.)-17397.*yt*yt+3767.*yt+1843.)/162./pow(yt-1.,5.)+yt*yt*(-63.*pow(yt,3.)+532.*yt*yt+2089.*yt-1118.)/27./pow(yt-1.,6.)*log(yt))
@@ -1201,6 +1209,8 @@ double C8H2ldlumt(double r)
 double C8H2(double yt, double lu, double ld, double L)
 {
 	if(fabs(1.-yt)<1.e-5) return C8H2(0.9999,lu,ld,L);
+	// Modified by GAMBIT, for values of yt close to 1 interpolate surrounding values
+	if(fabs(1.-yt)<1e-2) return C8H2(1.01,lu,ld,L)*(50.*yt-49.5) + C8H2(0.99,lu,ld,L)*(50.5-50*yt);
 
 	return lu*lu*(C8H2lulumt(yt)+L*(yt*(51948.*pow(yt,4.)-233781.*pow(yt,3.)+48634.*yt*yt-698693.*yt+2452.)/1944./pow(yt-1.,6.)*log(yt)-yt*(522347.*pow(yt,4.)-2423255.*pow(yt,3.)+2706021.*yt*yt-5930609.*yt+148856.)/11664./pow(yt-1.,5.)+yt*yt*(481.*pow(yt,3.)-1950.*yt*yt+1523.*yt-2550.)/18./pow(yt-1.,5.)*Li2(1.-1./yt))
 	+L*L*(yt*(-259.*pow(yt,4.)+1117.*pow(yt,3.)+2925.*yt*yt+28411.*yt+2366.)/216./pow(yt-1.,5.)-yt*yt*(139.*yt*yt+2938.*yt+2683.)/36./pow(yt-1.,6.)*log(yt))
@@ -1427,8 +1437,9 @@ double F11SP(double xt, double xH)
 	double xt2=xt*xt;
 	double xt3=xt*xt2;
 
+	// Modified by GAMBIT, fixed typo on expression compared to 1511.05066
 	return 1./2./(xH-xt)*(xt*(xt2-3.*xH*xt+9.*xH-5.*xt-2.)/4./(xt-1.)/(xt-1.)+xH*(xH*xt-3.*xH+2.*xt)/2./(xH-1.)/(xH-xt)*log(xH)
-	+(xH*xH*(-2.*xt3+6.*xt2-9.*xt+2.)+3.*xH*xt2*(xt2-2.*xt+3.)-xt2*(2.*xt3-2.*xt2+3.*xt+1.))*log(xt)/2./pow(xt-1.,3.)/(xH-xt));
+	+(xH*xH*(-2.*xt3+6.*xt2-9.*xt+2.)+3.*xH*xt2*(xt2-2.*xt+3.)-xt2*(2.*xt3-3.*xt2+3.*xt+1.))*log(xt)/2./pow(xt-1.,3.)/(xH-xt));
 }
 
 /*--------------------------------------------------------------------*/
@@ -1475,6 +1486,9 @@ double CPc_2HDM(double xH, double xt, do
 		if(fabs(1.-xt)<1.e-5) return CPc_2HDM(xH,0.9999,lu,ld,ll,sw2);
 
 		if(fabs(1.-xH/xt)<1.e-5) return CPc_2HDM(xt*0.9998,xt,lu,ld,ll,sw2);
+		// Modified by GAMBIT, for values of xH close to xt interpolate surrounding values
+		if(fabs(1.-xH/xt)<1.e-3) return CPc_2HDM(xt*1.01,xt,lu,ld,ll,sw2)*(50.*xH/xt-49.5) + CPc_2HDM(xt*0.99,xt,lu,ld,ll,sw2)*(50.5-50*xH/xt);
+
 		
 		return -xt/8./(xH-xt)*(2.*ld*ll*(1./(xH-1.)*log(xH)-1./(xt-1.)*log(xt))
 		+lu*ll*(1./(xH-1.)+xH/(xH-xt)/(xt-1.)*log(xt)-xH*(2.*xH-xt-1.)/(xH-xt)/(xH-1.)/(xH-1.)*log(xH))
@@ -1482,7 +1496,8 @@ double CPc_2HDM(double xH, double xt, do
 		+xt/4./(xH-xt)/(xH-xt)*(-ld*lu*(-(xt+xH)/2.+xt*xH/(xH-xt)*log(xH/xt))
 		+lu*lu/6./(xH-xt)*((xH*xH-8.*xH*xt-17.*xt*xt)/6.+xt*xt*(3.*xH+xt)/(xH-xt)*log(xH/xt)))
 		+sw2*xt/6./(xH-xt)/(xH-xt)*(-ld*lu*((5.*xt-3.*xH)/2.+xH*(2.*xH-3.*xt)/(xH-xt)*log(xH/xt))
-		+lu*lu/6./(xH-xt)*((4.*xH*xH*xH-12.*xH*xH*xt+xH*xt*xt+3.*xt*xt*xt)/(xH-xt)*log(xH/xt)-(17.*xH*xH-64.*xH*xt+71.*xt*xt)/6.))
+		// Modified by GAMBIT, fixed typo on expression compared to 1511.01829
+		+lu*lu/6./(xH-xt)*((4.*xH*xH*xH-12.*xH*xH*xt+9.*xH*xt*xt+3.*xt*xt*xt)/(xH-xt)*log(xH/xt)-(17.*xH*xH-64.*xH*xt+71.*xt*xt)/6.))
 		+(1.-sw2)*lu*lu*xt*xt/4./(xH-xt)/(xH-xt)*(xH*log(xH/xt)+xt-xH);
 }
 
